<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SafeRoute AI - Toronto Risk Map</title>
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="map"></div>
    
    <!-- Control Panel for OSM Layers -->
    <div class="control-panel">
        <h3>ğŸ—ºï¸ Map Layers</h3>
        
        <!-- Crime Layer Type Selector -->
        <div style="margin-bottom: 15px;">
            <label style="display: block; font-size: 12px; color: #000000; margin-bottom: 5px;">Crime Layer Type:</label>
            <select id="crime-layer-type" onchange="changeCrimeLayer()" style="width: 100%; padding: 8px; background: rgba(4, 4, 4, 0.1); color: #22b17b; border: 1px solid #000000; border-radius: 6px; cursor: pointer;">
                <option value="all">ğŸ¯ All Crimes (Weighted)</option>
                <option value="violent">âš ï¸ Violent Crimes</option>
                <option value="property">ğŸ  Property Crimes</option>
                <option value="personal">ğŸ‘¤ Personal Safety</option>
                <option value="vehicle">ğŸš— Vehicle Safety</option>
                <option value="bike">ğŸš² Bike Safety</option>
                <option value="critical">ğŸ”´ Critical (Homicide + Shooting)</option>
                <option value="assault">ğŸ‘Š Assault Only</option>
                <option value="robbery">ğŸ’° Robbery Only</option>
                <option value="breakenter">ğŸšª Break & Enter Only</option>
            </select>
        </div>
        
        <label class="layer-toggle">
            <input type="checkbox" id="toggle-crime" checked onchange="toggleLayer('crime')">
            <span>Show Crime Data</span>
        </label>
        
        <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #333;">
            <button id="show-network-btn" onclick="toggleNetworkDisplay()">ğŸ” Show Street Network</button>
        </div>
        
        <div style="margin-top: 10px;">
            <button id="routing-toggle-btn" onclick="toggleRoutingMode()">ğŸ—ºï¸ Plan Safe Route</button>
        </div>
        
        <!-- Transport Mode Selector REMOVED -->
        
        <!-- Report Crime Mode -->
        <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #333;">
            <button id="report-crime-btn" onclick="toggleReportCrimeMode()" style="width: 100%; padding: 10px; background: rgba(255,68,68,0.2); border: 1px solid #ff4444; color: #ff4444; border-radius: 8px; cursor: pointer; font-size: 13px; font-weight: bold; transition: all 0.3s;">
                ğŸš¨ Report Crime Event
            </button>
        </div>
        
        <!-- Gemini AI Safety Check -->
        <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #333;">
            <button id="fetch-crimes-btn" onclick="fetchLiveCrimes()" style="width: 100%; padding: 10px; background: rgba(102,126,234,0.2); border: 1px solid #667eea; color: #667eea; border-radius: 8px; cursor: pointer; font-size: 13px; font-weight: bold; transition: all 0.3s;">
                ğŸ¤– Fetch Live Crime Data
            </button>
            
            <div id="fetch-status" style="display:none; margin-top: 10px; padding: 10px; background: rgba(102,126,234,0.1); border-radius: 8px; border: 1px solid #667eea; font-size: 11px; color: #ccc;">
                <em>Status will appear here...</em>
            </div>
        </div>
        
        <div id="report-crime-panel" style="display:none; margin-top: 10px; padding: 12px; background: rgba(255,68,68,0.1); border-radius: 8px; border: 1px solid #ff4444;">
            <div style="font-size: 12px; color: #ff4444; margin-bottom: 8px; font-weight: bold;">
                ğŸ“ Click on map to report crime
            </div>
            <label style="display: block; font-size: 11px; color: #888; margin-bottom: 5px;">Crime Type:</label>
            <select id="crime-event-type" style="width: 100%; padding: 6px; background: rgba(0,0,0,0.3); color: #fff; border: 1px solid #444; border-radius: 6px; font-size: 12px; margin-bottom: 8px;">
                <option value="shooting">ğŸ”« Shooting</option>
                <option value="homicide">â˜ ï¸ Homicide</option>
                <option value="robbery">ğŸ’° Robbery</option>
                <option value="assault">ğŸ‘Š Assault</option>
                <option value="breakenter">ğŸšª Break & Enter</option>
                <option value="autotheft">ğŸš— Auto Theft</option>
            </select>
            <button onclick="clearCrimeEvents()" style="width: 100%; padding: 6px; background: rgba(255,255,255,0.1); border: 1px solid #666; color: #fff; border-radius: 6px; cursor: pointer; font-size: 11px;">
                ğŸ—‘ï¸ Clear All Events
            </button>
        </div>
        
        <div id="routing-instructions" style="display:none; margin-top: 10px; padding: 10px; background: rgba(0,255,136,0.1); border-radius: 8px; font-size: 12px;">
            <strong>ğŸ“ Click on the map:</strong><br>
            1ï¸âƒ£ First click = Start (A)<br>
            2ï¸âƒ£ Second click = End (B)
        </div>
        
        <!-- Legend -->
        <div id="legend" style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #333; font-size: 11px;">
            <strong style="display: block; margin-bottom: 8px; color: #00ff88;">Risk Levels:</strong>
            <div style="display: flex; align-items: center; margin-bottom: 4px;">
                <div style="width: 20px; height: 12px; background: #00ff00; margin-right: 8px; border-radius: 2px;"></div>
                <span>Low (0-30)</span>
            </div>
            <div style="display: flex; align-items: center; margin-bottom: 4px;">
                <div style="width: 20px; height: 12px; background: #ffff00; margin-right: 8px; border-radius: 2px;"></div>
                <span>Medium (30-60)</span>
            </div>
            <div style="display: flex; align-items: center; margin-bottom: 4px;">
                <div style="width: 20px; height: 12px; background: #ff6b35; margin-right: 8px; border-radius: 2px;"></div>
                <span>High (60-80)</span>
            </div>
            <div style="display: flex; align-items: center;">
                <div style="width: 20px; height: 12px; background: #ff0000; margin-right: 8px; border-radius: 2px;"></div>
                <span>Critical (80+)</span>
            </div>
        </div>
    </div>
    
    <!-- Route Result Panel -->
    <div id="route-result" class="route-result-panel" style="display:none;"></div>
    
    <!-- Info Panel -->
    <div class="info-panel">
        <h2>SafeRoute AI</h2>
        <p>Toronto Downtown</p>
        <div class="bounds-info">
            <small>ğŸ“ Area: 43.612Â°N to 43.823Â°N<br>
            79.563Â°W to 79.187Â°W</small>
        </div>
        <div id="stats"></div>
    </div>
    
    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <!-- Pathfinding JS -->
    <script src="pathfinding.js"></script>
    
    <!-- App JS -->
    <script src="app.js"></script>
</body>
</html>
